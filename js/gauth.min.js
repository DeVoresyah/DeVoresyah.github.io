// A simple authentication application written in HTML
// Copyright (C) 2012 Gerard Braad
//
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program.  If not, see <http://www.gnu.org/licenses/>.
//
// Originally based on the JavaScript implementation as provided by Russell Sayers on his Tin Isles blog:
// http://blog.tinisles.com/2011/10/google-authenticator-one-time-password-algorithm-in-javascript/
function dec2hex(t){return(t<15.5?"0":"")+Math.round(t).toString(16)}function hex2dec(t){return parseInt(t,16)}function base32tohex(t){for(var e="",r="",n=0;n<t.length;n++)e+=leftpad("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".indexOf(t.charAt(n).toUpperCase()).toString(2),5,"0");for(n=0;n+4<=e.length;n+=4){var h=e.substr(n,4);r+=parseInt(h,2).toString(16)}return r}function leftpad(t,e,r){return e+1>=t.length&&(t=Array(e+1-t.length).join(r)+t),t}function checkOtp(t,e){var r=base32tohex(e),n=Math.round((new Date).getTime()/1e3),h=leftpad(dec2hex(Math.floor(n/30)),16,"0"),c=new jsSHA("SHA-1","HEX");c.setHMACKey(r,"HEX"),c.update(h);var o=c.getHMAC("HEX"),a=0;"KEY MUST BE IN BYTE INCREMENTS"!==o&&(a=hex2dec(o.substring(o.length-1)));var f="https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=200x200&chld=M|0&cht=qr&chl=otpauth://totp/"+t+"%3Fsecret%3D"+e,s=(hex2dec(o.substr(2*a,8))&hex2dec("7fffffff"))+"";return[{qrcode:f,otpcode:s=s.substr(s.length-6,6)}]}
